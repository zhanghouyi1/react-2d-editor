<!--
 * @Author: zhanghouyi zhanghouyi@baoxiaohe.com
 * @Date: 2021-10-20 10:44:02
 * @LastEditors: zhanghouyi zhanghouyi@baoxiaohe.com
 * @LastEditTime: 2022-09-07 18:19:06
 * @FilePath: /public/index.html
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        svg {
            width: 100%;
            height: 100%;
            
        }

        .H {
            width: 20px;
            height: 200px;
            position: relative;
        }

        .slide {
            position: absolute;
            
        }
        .check1{
            left: 0px;
            top: 0px;
           
            width: 4px;
            height: 4px;
            border-radius: 50%;
            border: 2px solid #888;
            pointer-events: none;
        }
        .check2{
            left: 4px;
            top: 4px;
            border: 8px solid transparent;
            border-right-color: #888;
            width: 0;
            height: 0;
            pointer-events: none;
        }
        .show {
            width: 300px;
            height: 100px;
        }

        .HSV {
            display: flex;
        }

        .SV {
            width: 200px;
            margin-right: 10px;
            position: relative;
        }
    </style>
</head>

<body>
    <div class="HSV">
        <div class="SV">
            <svg id="getColor">
                <defs>
                    <linearGradient id="gradient-black" x1="0%" y1="100%" x2="0%" y2="0%">
                        <stop offset="0%" stop-color="#000000" stop-opacity="1"></stop>
                        <!-- endColor -->
                        <stop class="endColor" offset="100%" stop-color="#CC9A81" stop-opacity="0"></stop>
                    </linearGradient>
                    <linearGradient id="gradient-white" x1="100%" y1="100%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="#FF0000" stop-opacity="1"></stop>
                        <!-- endColor -->
                        <stop class="endColor" offset="100%" stop-color="#CC9A81" stop-opacity="0"></stop>
                    </linearGradient>
                </defs>
                <rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-white)"></rect>
                <rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-black)"></rect>
            </svg>
            <div class="slide check1"></div>
        </div>

        <div class="H">
            <svg>
                <defs>
                    <linearGradient id="gradient-hsv" x1="0%" y1="100%" x2="0%" y2="0%">
                        <stop offset="0%" stop-color="#FF0000" stop-opacity="1"></stop>
                        <stop offset="13%" stop-color="#FF00FF" stop-opacity="1"></stop>
                        <stop offset="25%" stop-color="#8000FF" stop-opacity="1"></stop>
                        <stop offset="38%" stop-color="#0040FF" stop-opacity="1"></stop>
                        <stop offset="50%" stop-color="#00FFFF" stop-opacity="1"></stop>
                        <stop offset="63%" stop-color="#00FF40" stop-opacity="1"></stop>
                        <stop offset="75%" stop-color="#0BED00" stop-opacity="1"></stop>
                        <stop offset="88%" stop-color="#FFFF00" stop-opacity="1"></stop>
                        <stop offset="100%" stop-color="#FF0000" stop-opacity="1"></stop>
                    </linearGradient>
                </defs>
                <rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-hsv)"></rect>
            </svg>
            <div class="slide check2"></div>
        </div>

        <div class="color">
            <h2>rgb(102, 81, 192)</h2>
            <div class="show" style="background: rgb(102, 81, 192);">

            </div>
        </div>
    </div>
</body>
<script>
    // app.js
    let H = document.querySelector('.H');
    let HRect = H.querySelector('rect');
    let HSlide = H.querySelector('.slide')
    let HFlag = false;

    let Hval = 0;
    let Sval = 100;
    let Vval = 100;

    HRect.addEventListener('mousedown', () => {
        HFlag = true;
    })
    HRect.addEventListener('mousemove', ev => {
        if (!HFlag) return;

        // ev.offsetY这个值为鼠标相对于源元素的Y坐标，算出滑块在元素中的定位比例
        let offsetY = ev.offsetY / H.offsetHeight;

        HSlide.style.top = ev.offsetY - 8 + 'px'

        // 因为H值的范围是0~360，乘以比例就可以得出一个颜色值了
        Hval = 360 * offsetY;
        console.log('Hval',Hval)
        setHSV();
    })
    HRect.addEventListener('mouseup', () => {
        HFlag = false;
    })

    let colorEl = document.querySelector('.color');
    let colorTitle = colorEl.querySelector('h2');
    let colorShow = colorEl.querySelector('.show');

    let SV = document.querySelector('.SV');
    // 这里我们选择第二个矩形，这样就不会被另一个矩形给遮住点击事件
    let SVRect = SV.querySelector('rect:last-child');
    let SVSlide = SV.querySelector('.slide');
    // let SVFlag = false;

    SVRect.addEventListener('mousedown', (ev) => {
        // 一波换算得出滑块的比例然后乘以100就是对应的SV的值了
        Sval = ev.offsetX / SV.offsetWidth * 100;
        // 透明度因为方向的问题所以就反转一下
        Vval = (1 - ev.offsetY / SV.offsetHeight) * 100;

        SVSlide.style.left = ev.offsetX  + 'px';
        SVSlide.style.top = ev.offsetY  + 'px';

        setHSV();
    })
    // SVRect.addEventListener('mousemove', ev => {
    //     if (!SVFlag) return;

       
    // })
    // SVRect.addEventListener('mouseup', () => {
    //     SVFlag = false;
    // })

    let endColors = document.querySelectorAll('.endColor');

    function setHSV() {
        // 这里算出对应的RGB值
        // 这个是最终结果的颜色
        let color = `
    rgb(${hsvtorgb(Hval, Sval, Vval).join(',')})
  `;
        // 这个是给SV设置的结束颜色
        let StopColor = `
    rgb(${hsvtorgb(Hval, 100, 100).join(',')})
  `;

        // 为在页面中的rect设置结束颜色
        [...endColors].map(el => el.setAttribute('stop-color', StopColor));
        console.log('color',color)
        colorTitle.innerHTML = color;
        colorShow.style.background = color;
    }

    function hsvtorgb(h, s, v) {
        s = s / 100;
        v = v / 100;
        var h1 = Math.floor(h / 60) % 6;
        var f = h / 60 - h1;
        var p = v * (1 - s);
        var q = v * (1 - f * s);
        var t = v * (1 - (1 - f) * s);
        var r, g, b;
        switch (h1) {
            case 0:
                r = v;
                g = t;
                b = p;
                break;
            case 1:
                r = q;
                g = v;
                b = p;
                break;
            case 2:
                r = p;
                g = v;
                b = t;
                break;
            case 3:
                r = p;
                g = q;
                b = v;
                break;
            case 4:
                r = t;
                g = p;
                b = v;
                break;
            case 5:
                r = v;
                g = p;
                b = q;
                break;
        }
        return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
    }
    setHSV();
</script>

</html>